{"version":3,"sources":["../src/Flux.js"],"names":[],"mappings":"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","file":"src/Flux.js","sourcesContent":["/**\n * Flux\n *\n * The main Flux class.\n */\n\nimport Store from './Store';\nimport Actions from './Actions';\nimport { Dispatcher } from 'flux';\nimport EventEmitter from 'eventemitter3';\n\nexport default class Flux extends EventEmitter {\n\n  constructor() {\n    this.dispatcher = new Dispatcher();\n\n    this._stores = {};\n    this._actions = {};\n  }\n\n  createStore(key, _Store, ...constructorArgs) {\n\n    if (!(_Store.prototype instanceof Store)) {\n      const className = getClassName(_Store);\n\n      throw new Error(\n        `You've attempted to create a store from the class ${className}, which `\n      + `does not have the base Store class in its prototype chain. Make sure `\n      + `you're using the \\`extends\\` keyword: \\`class ${className} extends `\n      + `Store { ... }\\``\n      );\n    }\n\n    if (this._stores.hasOwnProperty(key) && this._stores[key]) {\n      throw new Error(\n        `You've attempted to create multiple stores with key ${key}. Keys must `\n      + `be unique.`\n      );\n    }\n\n    const store = new _Store(...constructorArgs);\n    const token = this.dispatcher.register(store.handler.bind(store));\n\n    store._waitFor = this.waitFor.bind(this);\n    store._token = token;\n    store._getAllActionIds = this.getAllActionIds.bind(this);\n\n    this._stores[key] = store;\n\n    return store;\n  }\n\n  getStore(key) {\n    return this._stores.hasOwnProperty(key) ? this._stores[key] : undefined;\n  }\n\n  createActions(key, _Actions, ...constructorArgs) {\n\n    if (!(_Actions.prototype instanceof Actions) && _Actions !== Actions) {\n      const className = getClassName(_Actions);\n\n      throw new Error(\n        `You've attempted to create actions from the class ${className}, which `\n      + `does not have the base Actions class in its prototype chain. Make `\n      + `sure you're using the \\`extends\\` keyword: \\`class ${className} `\n      + `extends Actions { ... }\\``\n      );\n    }\n\n    if (this._actions.hasOwnProperty(key) && this._actions[key]) {\n      throw new Error(\n        `You've attempted to create multiple actions with key ${key}. Keys `\n      + `must be unique.`\n      );\n    }\n\n    const actions = new _Actions(...constructorArgs);\n    actions.dispatch = this.dispatch.bind(this);\n    actions.dispatchAsync = this.dispatchAsync.bind(this);\n\n    this._actions[key] = actions;\n\n    return actions;\n  }\n\n  getActions(key) {\n    return this._actions.hasOwnProperty(key) ? this._actions[key] : undefined;\n  }\n\n  getActionIds(key) {\n    const actions = this.getActions(key);\n\n    if (!actions) return;\n\n    return actions.getConstants();\n  }\n\n  getAllActionIds() {\n    let actionIds = [];\n\n    for (let key in this._actions) {\n      if (!this._actions.hasOwnProperty(key)) continue;\n\n      const actionConstants = this._actions[key].getConstants();\n\n      actionIds = actionIds.concat(getValues(actionConstants));\n    }\n\n    return actionIds;\n  }\n\n  dispatch(actionId, body) {\n    this._dispatch({ actionId, body });\n  }\n\n  dispatchAsync(actionId, promise, actionArgs) {\n    const payload = {\n      actionId,\n      async: 'begin',\n    };\n\n    if (actionArgs) payload.actionArgs = actionArgs;\n\n    this._dispatch(payload);\n\n    return promise\n      .then(\n        body => {\n          this._dispatch({\n            actionId,\n            body,\n            async: 'success'\n          });\n\n          return body;\n        },\n        error => {\n          this._dispatch({\n            actionId,\n            error,\n            actionArgs: actionArgs,\n            async: 'failure',\n          });\n\n          return Promise.reject(error);\n        }\n      )\n      .catch(error => {\n        this.emit('error', error);\n\n        return Promise.reject(error);\n      });\n  }\n\n  _dispatch(payload) {\n    this.dispatcher.dispatch(payload);\n    this.emit('dispatch', payload);\n  }\n\n  waitFor(tokensOrStores) {\n\n    if (!Array.isArray(tokensOrStores)) tokensOrStores = [tokensOrStores];\n\n    const ensureIsToken = tokenOrStore => {\n      return tokenOrStore instanceof Store\n        ? tokenOrStore._token\n        : tokenOrStore;\n    };\n\n    const tokens = tokensOrStores.map(ensureIsToken);\n\n    this.dispatcher.waitFor(tokens);\n  }\n\n  removeAllStoreListeners(event) {\n    for (let key in this._stores) {\n      if (!this._stores.hasOwnProperty(key)) continue;\n\n      const store = this._stores[key];\n\n      store.removeAllListeners(event);\n    }\n  }\n\n  serialize() {\n    const stateTree = {};\n\n    for (let key in this._stores) {\n      if (!this._stores.hasOwnProperty(key)) continue;\n\n      const store = this._stores[key];\n\n      const serialize = store.constructor.serialize;\n\n      if (typeof serialize !== 'function') continue;\n\n      const serializedStoreState = serialize(store.state);\n\n      if (typeof serializedStoreState !== 'string') {\n        const className = store.constructor.name;\n\n        if (process.env.NODE_ENV !== 'production') {\n          console.warn(\n            `The store with key '${key}' was not serialized because the static `\n          + `method \\`${className}.serialize()\\` returned a non-string with type `\n          + `'${typeof serializedStoreState}'.`\n          );\n        }\n      }\n\n      stateTree[key] = serializedStoreState;\n\n      if (typeof store.constructor.deserialize !== 'function') {\n        const className = store.constructor.name;\n\n        if (process.env.NODE_ENV !== 'production') {\n          console.warn(\n            `The class \\`${className}\\` has a \\`serialize()\\` method, but no `\n          + `corresponding \\`deserialize()\\` method.`\n          );\n        }\n      }\n\n    }\n\n    return JSON.stringify(stateTree);\n  }\n\n  deserialize(serializedState) {\n    let stateMap;\n\n    try {\n      stateMap = JSON.parse(serializedState);\n    } catch (error) {\n      const className = this.constructor.name;\n\n      if (process.env.NODE_ENV !== 'production') {\n        throw new Error(\n          `Invalid value passed to \\`${className}#deserialize()\\`: `\n        + `${serializedState}`\n        );\n      }\n    }\n\n    for (let key in this._stores) {\n      if (!this._stores.hasOwnProperty(key)) continue;\n\n      const store = this._stores[key];\n\n      const deserialize = store.constructor.deserialize;\n\n      if (typeof deserialize !== 'function') continue;\n\n      const storeStateString = stateMap[key];\n      const storeState = deserialize(storeStateString);\n\n      store.replaceState(storeState);\n\n      if (typeof store.constructor.serialize !== 'function') {\n        const className = store.constructor.name;\n\n        if (process.env.NODE_ENV !== 'production') {\n          console.warn(\n            `The class \\`${className}\\` has a \\`deserialize()\\` method, but no `\n          + `corresponding \\`serialize()\\` method.`\n          );\n        }\n      }\n    }\n  }\n\n}\n\n// Aliases\nFlux.prototype.getConstants = Flux.prototype.getActionIds;\nFlux.prototype.getAllConstants = Flux.prototype.getAllActionIds;\nFlux.prototype.dehydrate = Flux.prototype.serialize;\nFlux.prototype.hydrate = Flux.prototype.deserialize;\n\nfunction getClassName(Class) {\n  return Class.prototype.constructor.name;\n}\n\nfunction getValues(object) {\n  let values = [];\n\n  for (let key in object) {\n    if (!object.hasOwnProperty(key)) continue;\n\n    values.push(object[key]);\n  }\n\n  return values;\n}\n\nconst Flummox = Flux;\n\nexport {\n  Flux,\n  Flummox,\n  Store,\n  Actions,\n};\n"]}